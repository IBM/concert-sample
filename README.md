# concert-sample

This samples has been tested on linux system.  Working on testing on macos with proper docker runtime. 

The sample is simulating a CI/CD pipeline and how is integated into concert.  We will include a CD pipeline update, where we will emilate the release of an application to the target environment and the data that concert needs for that use case.

## Pre-requisites

1) **Access keys for images in Staging**

We use stg.icr.io to host daily build images.

Visit:  https://github.ibm.com/alchemy-registry/image-iam/blob/master/obtaining_entitlement.md#obtaining-a-staging-entitlement-key for getting access keys (entitlement keys)

- you will need to set this as `IBM_ENTITLEMENT_KEY` below

```bash
export IBM_ENTITLEMENT_KEY=...
```

2) docker running on the environment, or podman configure with the docker emulation.
3) jq utilities


## Setup Instruction

1) switch to the concert-sample/scripts directoty and run setup command.
   ./scripts/helper/setup.sh
2) Update environment details, switch to concert-sample/cncert_data and update the application_def_load_config.yaml and the simulating_ci_config.yaml.  Enter the proper information for the target environment you want to use on both configu files.

   app:
   base_url: "<https://concert_url:concert_port>"
   instance_id: "<your_instance_id>"
   auth:
      user:
         username: "<your_username>"
         password: "<your_password>"

## Run sample
The order of steps in 2 and 3 is not important, but to show the full capablities of concert it is important to do all task.  Also not all pieces need to be done, but the important things are to provide the cyclondx sbom, the CVE(when enable).  The application and build inventory files/sboms that are generated by the sample can be loaded from the ci pipelines to help concert understand the application. 

1) switch to concert-sample/scripts
2) run the application _definition.sh sample.  This is only done once, or when updates to the application definition needs to be done.
   ./application_definition.sh
3) run the simulate_ci_pipeline.sh sample.  This is only done on every CI will generate application assets (image, sbom(code scan), Image scan(Sbom, cve report)) to represent a commited version that can be release to any environment including quality environments.
   ./simulate_ci_pipeline.sh
